<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>SQL查询工具</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Droid Sans", "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Droid Sans Fallback", "Microsoft YaHei", sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 20px;
    }
    
    .sql-input-section {
      margin-bottom: 20px;
    }
    
    .sql-input-section label {
      display: block;
      font-weight: 500;
      margin-bottom: 8px;
      color: #333;
    }
    
    #sqlQuery {
      width: 100%;
      height: 120px;
      padding: 12px;
      box-sizing: border-box;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: monospace;
      font-size: 14px;
      resize: vertical;
      margin-bottom: 12px;
    }
    
    .example-sql {
      background-color: #f0f0f0;
      padding: 12px;
      border-radius: 4px;
      margin-bottom: 12px;
      font-family: monospace;
      font-size: 14px;
      white-space: pre-wrap;
    }
    
    .example-sql h3 {
      margin-top: 0;
      margin-bottom: 8px;
      font-size: 16px;
      color: #666;
    }
    
    .btn {
      background-color: #07c160;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
    }
    
    .btn:hover {
      background-color: #06b356;
    }
    
    .result-section {
      margin-top: 20px;
    }
    
    .result-section h2 {
      font-size: 18px;
      margin-bottom: 12px;
      color: #333;
    }
    
    #result {
      width: 100%;
      padding: 12px;
      box-sizing: border-box;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: monospace;
      font-size: 14px;
      background-color: #fafafa;
      min-height: 100px;
      white-space: pre-wrap;
      overflow-x: auto;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>SQL执行工具</h1>
    
    <div class="sql-input-section">
      <label for="sqlQuery">输入SQL语句：</label>
      <textarea id="sqlQuery" placeholder="请输入SQL语句..."></textarea>
      
      <div class="example-sql">
        <h3>示例1 - 查询：</h3>
        SELECT *  
FROM device_info_basic 
WHERE device_id = 'Test_Connect';
      </div>
      
      <div class="example-sql">
        <h3>示例2 - 新增：</h3>
        INSERT INTO device_info_basic (device_id, device_type, rated_power, main_version, sub_version, bms_mode, cabinet_version, cooling_method, production_plant, production_date, serial_number) 
VALUES ('Test_Insert', '组串式PCS', '430kW', 'Vinco200版', '第3版', '不内置', '不适用', '液冷Liquid-Cooled', '汇川HC', '2025-09-30', '00085');
      </div>
      
      <button class="btn" onclick="executeSql()">提交</button>
    </div>
    
    <div class="result-section">
      <h2>执行结果：</h2>
      <pre id="result"></pre>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
  <script>
    function executeSql() {
      var sql = $("#sqlQuery").val();
      
      if (!sql.trim()) {
        alert("请输入SQL语句");
        return;
      }
      
      $.ajax("/api/execute_sql", {
        method: "POST",
        contentType: "application/json",
        data: JSON.stringify({ sql: sql }),
        success: function (res) {
          $("#result").text(JSON.stringify(res, null, 2));
        },
        error: function (err) {
          var errorMsg = "执行失败，请稍后重试";
          if (err.responseJSON) {
            errorMsg = JSON.stringify(err.responseJSON, null, 2);
          } else if (err.responseText) {
            errorMsg = err.responseText;
          }
          $("#result").text(errorMsg);
        }
      });
    }
    
    // 页面加载时自动填充示例SQL
    $(document).ready(function() {
      $("#sqlQuery").val("SELECT *  \nFROM device_info_basic \nWHERE device_id = 'Test_Connect';");
    });
  </script>
</body>

</html>
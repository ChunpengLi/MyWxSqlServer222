<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <link rel="shortcut icon"
    href="https://static-index-4gtuqm3bfa95c963-1304825656.tcloudbaseapp.com/official-website/favicon.svg"
    mce_href="https://static-index-4gtuqm3bfa95c963-1304825656.tcloudbaseapp.com/official-website/favicon.svg"
    type="image/x-icon" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
  <title>HS设备管理小程序-后端测试平台</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Droid Sans", "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Droid Sans Fallback", "Microsoft YaHei", sans-serif;
    }

    .title-logo {
      width: 80px;
      height: 80px;
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    @media screen and (min-width:1200px) {
      body .top {
        margin-top: 105px;
      }
      body .container {
        margin-top: 0;
        margin-bottom: 272px;
      }
    }

    @media screen and (max-width:1919px) {
      body .container {
        margin-top: 0;
        margin-bottom: 128px;
      }
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .count-button {
      width: 320px;
      height: 40px;
      box-sizing: border-box;
      margin: 16px 8px;
      font-weight: 500;
      font-size: 17px;
      color: #FFFFFF;
      letter-spacing: 1px;
      text-align: center;
      border-radius: 4px;
    }

    .count-number {
      align-self: flex-start;
      opacity: 0.9;
      font-weight: 500;
      font-size: 14px;
      color: #000000;
    }

    .count-reset {
      color: #576b95;
      cursor: pointer;
      margin-left: auto;
    }

    .count-text {
      width: 320px;
      height: 40px;
      padding: 0 12px;
      margin: 0 auto;
      line-height: 40px;
      text-align: left;
      display: flex;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 4px;
      opacity: 0.9;
      box-sizing: border-box;
      font-weight: 400;
      font-size: 14px;
      color: #000000;
    }

    .quote {
      font-size: 12px;
    }

    .qrcode {
      height: 144px;
      width: 144px;
      display: block;
      margin: 0 auto;
    }

    .title {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      width: 320px;
    }

    .title-text {
      width: 320px;
      height: 48px;
      text-align: center;
      margin-top: 16px;
      font-size: 32px;
      opacity: 0.9;
      font-weight: 500;
      font-size: 32px;
      color: #000000;
      letter-spacing: 0;
      line-height: 48px;
    }

    .counter-container {
      margin-top: 48px;
    }

    .hr {
      text-align: center;
      position: relative;
      z-index: 2;
      height: 20px;
      line-height: 20px;
    }

    .hr::after {
      position: absolute;
      content: '';
      top: 10px;
      left: 60px;
      width: 200px;
      border-bottom: 1px solid rgba(0, 0, 0, .1);
      z-index: -1;
    }

    .hr small {
      display: inline-block;
      background-color: white;
    }

    .hr-text {
      display: inline-block;
      height: 20px;
      font-weight: 400;
      font-size: 14px;
      color: rgba(0, 0, 0, 0.55);
      letter-spacing: 0;
      text-align: center;
      z-index: 2;
      background-color: white;
      padding: 0 8px;
      line-height: 20px;
    }

    .link-button {
      width: 154px;
      height: 48px;
      box-sizing: border-box;
      font-weight: 400;
      font-size: 14px;
      color: rgba(0, 0, 0, 0.90);
      letter-spacing: 0;
      text-align: center;
      background: rgba(0, 0, 0, 0.03);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .card {
      margin-top: 16px;
      width: 320px;
      height: 200px;
      box-sizing: border-box;
      border: 1px solid rgba(0, 0, 0, 0.10);
      border-radius: 5.71px;
      position: relative;
    }

    .card-text {
      text-align: center;
      font-weight: 400;
      font-size: 14px;
      color: rgba(0, 0, 0, 0.55);
      letter-spacing: 0;
    }

    .top {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 21px;
      margin-bottom: 20px;
    }
    .alert {
      font-size: 14px;
      color: rgba(0, 0, 0, 0.55);
      border: 1px solid #f2f4f8;
      background: #f2f4f8;
      padding: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
      margin: 0;
    }
    .alert-icon {
      flex-shrink: 0;
      flex-grow: 0;
      color: #c04100;
    }
  </style>
</head>

<body>
  <div class="top">
    <div class="alert">
      <svg id="error-circle" class="alert-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g fill="none"><g clip-path="url(#clip0_19498_602)"><path d="M8.00016 2.00002C11.3139 2.00002 14.0002 4.68631 14.0002 8.00002C14.0002 11.3137 11.3139 14 8.00016 14C4.68646 14 2.00016 11.3137 2.00016 8.00002C2.00016 4.68631 4.68645 2.00002 8.00016 2.00002ZM15.3335 8.00002C15.3335 3.94993 12.0503 0.666687 8.00016 0.666688C3.95008 0.666688 0.66683 3.94993 0.666831 8.00002C0.666831 12.0501 3.95008 15.3334 8.00016 15.3334C12.0503 15.3334 15.3335 12.0501 15.3335 8.00002ZM7.3335 4.33335L7.3335 9.33335L8.66683 9.33335L8.66683 4.33335L7.3335 4.33335ZM8.66683 10.3334L7.33089 10.3334L7.33089 11.6693L8.66683 11.6693L8.66683 10.3334Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" fill-opacity="0.9"></path></g><defs><clipPath id="clip0_19498_602"><rect width="16" height="16" fill="white"></rect></clipPath></defs></g></svg>
      <span>默认域名仅支持测试使用，服务上线生产请绑定自定义域名；测试期间默认域名浏览器操作有有效时间，过期后需手动续期。</span>
    </div>
  </div>
  <div class="container">
    <div class="title">
      <img class="title-logo"
        src="https://static-index-4gtuqm3bfa95c963-1304825656.tcloudbaseapp.com/official-website/favicon.svg" />
      <div style="display: inline; margin-bottom: 48px" class="title-text">HS设备管理小程序-后端测试平台</div>
    </div>
    <div style="text-align: center; display: flex; flex-direction: column; align-items: center; margin: 0">
      <div style="margin-bottom: 16px; width: 320px; text-align: left;">
        <label for="deviceId" style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">设备ID:</label>
        <input type="text" id="deviceId" placeholder="请输入设备ID" style="width: 100%; height: 40px; padding: 0 12px; box-sizing: border-box; border: 1px solid rgba(0, 0, 0, 0.1); border-radius: 4px; margin-bottom: 16px;">
      </div>
      <a class="btn btn-success btn-lg count-button" style="background: #07c160; border: 0; margin-bottom: 16px;"
        onclick="queryDevice()">查询设备信息</a>
      <a class="btn btn-primary btn-lg count-button" style="background: #1890ff; border: 0; margin-bottom: 16px;"
        onclick="testDbConnection()">测试数据库连接</a>
      <div style="margin-bottom: 16px; width: 320px;">
        <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 500; text-align: center;">查询结果</h3>
        <div id="deviceInfoResult" style="width: 100%; padding: 16px; box-sizing: border-box; border: 1px solid rgba(0, 0, 0, 0.1); border-radius: 4px; background: #fafafa;">
          <div class="count-text" style="justify-content: center; margin-bottom: 8px;">
            <span>查询结果:</span>
            <span class="count-number" style="margin-left: 8px;"></span>
          </div>
          <div id="deviceDetails" style="margin-top: 16px; display: none;">
            <table style="width: 100%; border-collapse: collapse;">
              <tr>
                <td style="padding: 8px; text-align: left; font-weight: 500; border-bottom: 1px solid rgba(0, 0, 0, 0.1);">生产日期:</td>
                <td id="prodDate" style="padding: 8px; text-align: left; border-bottom: 1px solid rgba(0, 0, 0, 0.1);"></td>
              </tr>
              <tr>
                <td style="padding: 8px; text-align: left; font-weight: 500; border-bottom: 1px solid rgba(0, 0, 0, 0.1);">箱体码:</td>
                <td id="containerCode" style="padding: 8px; text-align: left; border-bottom: 1px solid rgba(0, 0, 0, 0.1);"></td>
              </tr>
              <tr>
                <td style="padding: 8px; text-align: left; font-weight: 500; border-bottom: 1px solid rgba(0, 0, 0, 0.1);">IP地址:</td>
                <td id="ipAddr" style="padding: 8px; text-align: left; border-bottom: 1px solid rgba(0, 0, 0, 0.1);"></td>
              </tr>
              <tr>
                <td style="padding: 8px; text-align: left; font-weight: 500; border-bottom: 1px solid rgba(0, 0, 0, 0.1);">问题记录:</td>
                <td id="issueRecord" style="padding: 8px; text-align: left; border-bottom: 1px solid rgba(0, 0, 0, 0.1);"></td>
              </tr>
              <tr>
                <td style="padding: 8px; text-align: left; font-weight: 500;">备注:</td>
                <td id="remark" style="padding: 8px; text-align: left;"></td>
              </tr>
            </table>
          </div>
          <div id="repairInfoResult" style="margin-top: 24px; display: none;">
            <h4 style="margin-bottom: 12px; font-size: 16px; font-weight: 500;">维修记录</h4>
            <table id="repairTable" style="width: 100%; border-collapse: collapse; border: 1px solid rgba(0, 0, 0, 0.1);">
              <thead>
                <tr>
                  <th style="padding: 8px; text-align: center; font-weight: 500; border-bottom: 1px solid rgba(0, 0, 0, 0.1); background: #f0f0f0;">维修日期</th>
                  <th style="padding: 8px; text-align: center; font-weight: 500; border-bottom: 1px solid rgba(0, 0, 0, 0.1); background: #f0f0f0;">维修记录</th>
                  <th style="padding: 8px; text-align: center; font-weight: 500; border-bottom: 1px solid rgba(0, 0, 0, 0.1); background: #f0f0f0;">维修人员</th>
                  <th style="padding: 8px; text-align: center; font-weight: 500; border-bottom: 1px solid rgba(0, 0, 0, 0.1); background: #f0f0f0;">创建时间</th>
                </tr>
              </thead>
              <tbody id="repairTableBody">
                <!-- 维修记录将动态插入这里 -->
              </tbody>
            </table>
            <div id="noRepairRecord" style="margin-top: 12px; text-align: center; color: #666; font-style: italic; display: none;">没有找到维修记录</div>
          </div>
        </div>
      </div>
      <div style="margin-bottom: 32px; width: 320px;">
        <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 500; text-align: center;">添加设备信息</h3>
        <div style="margin-bottom: 16px;">
          <label for="addDeviceId" style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">设备ID:</label>
          <input type="text" id="addDeviceId" placeholder="请输入设备ID" style="width: 100%; height: 40px; padding: 0 12px; box-sizing: border-box; border: 1px solid rgba(0, 0, 0, 0.1); border-radius: 4px; margin-bottom: 16px;">
        </div>
        <div style="margin-bottom: 16px;">
          <label for="addProductionDate" style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">生产日期:</label>
          <input type="date" id="addProductionDate" style="width: 100%; height: 40px; padding: 0 12px; box-sizing: border-box; border: 1px solid rgba(0, 0, 0, 0.1); border-radius: 4px; margin-bottom: 16px;">
        </div>
        <a class="btn btn-success btn-lg count-button" style="background: #07c160; border: 0; margin-bottom: 16px;" onclick="addDevice()">添加设备</a>
      </div>
      <div style="margin-bottom: 48px; width: 320px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
          <label for="logText" style="font-weight: 500; font-size: 14px;">日志信息:</label>
          <button type="button" class="btn btn-sm btn-outline-danger" onclick="clearLogs()" style="padding: 2px 8px; font-size: 12px;">清空日志</button>
        </div>
        <textarea id="logText" style="width: 100%; height: 200px; padding: 12px; box-sizing: border-box; border: 1px solid rgba(0, 0, 0, 0.1); border-radius: 4px; resize: vertical; font-family: monospace; font-size: 12px;" readonly></textarea>
      </div>
      <div class="card" style="width: 320px; margin-bottom: 48px;">
        <div class="card-body">
          <img class="qrcode middle"
            src="https://qcloudimg.tencent-cloud.cn/raw/89b46988d3cd73d8a56e76a1b82bb377.png" />
          <small class="card-text" style="display: flex; justify-content: center; margin-top: 8px">扫码加入微信云托管用户群</small>
        </div>
      </div>
      <div>
        <div class="hr">
          <span class="hr-text">快速入门</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-top: 16px;">
          <a class="btn btn-light btn-lg link-button" style="border: 0; box-shadow: none; margin-right: 12px;"
            href="https://developers.weixin.qq.com/miniprogram/dev/wxcloudrun/src/basic/intro.html" target="_blank"
            rel="noopener noreferrer">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px"
              height="24px" viewBox="0 0 24 24">
              <title>icons_outline_warrant copy</title>
              <g id="icons_outline_warrant-copy" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <g id="0.&#x56FE;&#x6807;/&#x7EBF;&#x578B;/icons_outlined_copy">
                  <rect id="Rectangle" x="0" y="0" width="20" height="20"></rect>
                  <path
                    d="M13.9979043,2 L20,8 L20,21.0013542 C20,21.5542301 19.5541613,22 19.0041915,22 L5.99580851,22 C5.44892021,22 5,21.552891 5,21.0013542 L5,2.99864581 C5,2.44576991 5.44583866,2 5.99580851,2 L13.9979043,2 Z M12.399,3.2 L6.2,3.2 L6.2,20.8 L18.8,20.8 L18.8,9.6 L14,9.6 C13.1163444,9.6 12.4,8.8836556 12.4,8 L12.399,3.2 Z M14.2,14.4 L14.2,15.6 L7.8,15.6 L7.8,14.4 L14.2,14.4 Z M17.2,12 L17.2,13.2 L7.8,13.2 L7.8,12 L17.2,12 Z M13.599,3.299 L13.6,8 C13.6,8.2209139 13.7790861,8.4 14,8.4 L18.703,8.4 L13.599,3.299 Z"
                    id="Combined-Shape" fill-opacity="0.9" fill="#000000"></path>
                </g>
              </g>
            </svg>
            <span style="margin-left: 4px">开发者文档</span></a>
          <a class="btn btn-light btn-lg link-button" style="border: 0; box-shadow: none;"
            href="https://developers.weixin.qq.com/community/business/course/00068c2c0106c0667f5b01d015b80d"
            target="_blank" rel="noopener noreferrer">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px"
              height="24px" viewBox="0 0 24 24">
              <title>icons_outlined_play</title>
              <g id="&#x573A;&#x666F;&#x5316;&#x90E8;&#x7F72;" stroke="none" stroke-width="1" fill="none"
                fill-rule="evenodd">
                <g id="icons_outlined_play">
                  <rect id="Rectangle-664" x="0" y="0" width="20" height="20"></rect>
                  <path
                    d="M12,20.8 C16.8601058,20.8 20.8,16.8601058 20.8,12 C20.8,7.1398942 16.8601058,3.2 12,3.2 C7.1398942,3.2 3.2,7.1398942 3.2,12 C3.2,16.8601058 7.1398942,20.8 12,20.8 Z M12,22 C6.4771525,22 2,17.5228475 2,12 C2,6.4771525 6.4771525,2 12,2 C17.5228475,2 22,6.4771525 22,12 C22,17.5228475 17.5228475,22 12,22 Z M10.7,14.8349028 L15.2358445,12 L10.7,9.16509717 L10.7,14.8349028 Z M10.2649995,7.47812467 L16.8216014,11.5760008 C17.0557696,11.722356 17.1269562,12.0308312 16.980601,12.2649995 C16.9403607,12.329384 16.8859859,12.3837588 16.8216014,12.4239992 L10.2649995,16.5218753 C10.0308312,16.6682305 9.72235601,16.5970439 9.57600085,16.3628756 C9.52633472,16.2834098 9.5,16.191586 9.5,16.0978762 L9.5,7.90212382 C9.5,7.62598145 9.72385763,7.40212382 10,7.40212382 C10.0937099,7.40212382 10.1855337,7.42845854 10.2649995,7.47812467 Z"
                    id="Oval-78" fill-opacity="0.9" fill="#000000"></path>
                </g>
              </g>
            </svg>
            <span style="margin-left: 4px">视频教程</span></a>
        </div>
      </div>
    </div>
  </div>
</body>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js",
  integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<script>
  // 日志记录函数
  function log(msg) {
    // 获取当前时间
    var now = new Date();
    var timestamp = now.toLocaleString();
    // 添加时间戳到日志信息
    var logMsg = "[" + timestamp + "] " + msg + "\n";
    // 获取当前日志内容
    var currentLog = $("#logText").val();
    // 将新日志添加到日志文本框
    $("#logText").val(currentLog + logMsg);
    // 滚动到底部
    scrollLogToBottom();
  }
  
  // 滚动日志到底部
  function scrollLogToBottom() {
    var logText = document.getElementById("logText");
    logText.scrollTop = logText.scrollHeight;
  }
  
  // 从后端获取日志
  function fetchLogs() {
    $.ajax("/api/logs", {
      method: "GET",
      dataType: "json",
      success: function (res) {
        if (res && res.data !== undefined) {
          // 直接设置日志内容，因为后端已经包含了完整的日志
          $("#logText").val(res.data);
          scrollLogToBottom();
        }
      },
      error: function (err) {
        console.error("获取日志失败:", err);
      }
    });
  }
  
  // 清空日志
  function clearLogs() {
    $.ajax("/api/logs", {
      method: "DELETE",
      dataType: "json",
      success: function (res) {
        $("#logText").val("");
        log("日志已清空");
      },
      error: function (err) {
        console.error("清空日志失败:", err);
        log("清空日志失败");
      }
    });
  }
  
  // 定时获取日志（每秒一次）
  setInterval(fetchLogs, 1000);
  
  // 页面加载时获取一次日志
  $(document).ready(function() {
    fetchLogs();
  });
  
  function queryDevice() {
    // 获取设备ID
    var deviceId = $("#deviceId").val();
    
    // 检查设备ID是否为空
    if (!deviceId) {
      alert("请输入设备ID");
      return;
    }
    
    // 调用API查询设备
    var url = "/api/device?device_id=" + deviceId;
    
    $.ajax(url, {
      method: "GET",
      dataType: "json",
      success: function (res) {
        if (res && res.data !== undefined) {
          // 清空之前的结果
          $("#deviceDetails").hide();
          $("#repairInfoResult").hide();
          $("#repairTableBody").empty();
          
          // 检查返回的数据类型
          if (typeof res.data === 'object') {
            // 是设备信息对象，显示详细信息
            $("span.count-number").html("成功");
            
            // 填充设备信息
            $("#prodDate").text(res.data.production_date || "(空)");
            $("#containerCode").text(res.data.container_code || "(空)");
            $("#ipAddr").text(res.data.ip_addr || "(空)");
            $("#issueRecord").text(res.data.issue_record || "(空)");
            $("#remark").text(res.data.remark || "(空)");
            
            // 显示设备详情
            $("#deviceDetails").show();
            
            // 查询维修信息
            queryRepairInfo(deviceId);
          } else {
            // 是字符串，直接显示
            $("span.count-number").html(res.data);
          }
        } else {
          alert("查询结果格式异常");
        }
      },
      error: function (err) {
        var errorMsg = "查询失败，请稍后重试";
        if (err.responseJSON) {
          if (err.responseJSON.errorMsg) {
            errorMsg = err.responseJSON.errorMsg;
          } else if (err.responseJSON.msg) {
            errorMsg = err.responseJSON.msg;
          }
        } else if (err.responseText) {
          errorMsg = err.responseText;
        }
        alert(errorMsg);
      }
    });
  }
  
  // 查询维修信息
  function queryRepairInfo(deviceId) {
    var repairUrl = "/api/repair?device_id=" + deviceId;
    
    $.ajax(repairUrl, {
      method: "GET",
      dataType: "json",
      success: function (res) {
        if (res && res.data !== undefined) {
          // 显示维修信息结果
          $("#repairInfoResult").show();
          
          // 清空之前的维修记录
          $("#repairTableBody").empty();
          $("#noRepairRecord").hide();
          
          // 检查维修记录
          if (Array.isArray(res.data) && res.data.length > 0) {
            // 有维修记录，动态生成表格行
            res.data.forEach(function(repair) {
              var tr = $('<tr></tr>');
              tr.append($('<td style="padding: 8px; text-align: center; border-bottom: 1px solid rgba(0, 0, 0, 0.1);"></td>').text(repair.repair_date || "(空)"));
              tr.append($('<td style="padding: 8px; text-align: center; border-bottom: 1px solid rgba(0, 0, 0, 0.1);"></td>').text(repair.repair_note || "(空)"));
              tr.append($('<td style="padding: 8px; text-align: center; border-bottom: 1px solid rgba(0, 0, 0, 0.1);"></td>').text(repair.engineer_name || "(空)"));
              tr.append($('<td style="padding: 8px; text-align: center; border-bottom: 1px solid rgba(0, 0, 0, 0.1);"></td>').text(repair.create_time || "(空)"));
              $("#repairTableBody").append(tr);
            });
          } else {
            // 没有维修记录
            $("#noRepairRecord").show();
          }
        } else {
          console.error("维修信息查询结果格式异常");
        }
      },
      error: function (err) {
        console.error("查询维修信息失败:", err);
        // 显示没有维修记录
        $("#repairInfoResult").show();
        $("#noRepairRecord").show();
      }
    });
  }
  
  function testDbConnection() {
    // 调用API测试数据库连接
    var url = "/api/test_db";
    
    $.ajax(url, {
      method: "GET",
      dataType: "json",
      success: function (res) {
        if (res && res.data !== undefined) {
          alert(res.data);
        } else {
          alert("测试结果格式异常");
        }
      },
      error: function (err) {
        var errorMsg = "测试数据库连接失败，请稍后重试";
        if (err.responseJSON) {
          if (err.responseJSON.errorMsg) {
            errorMsg = err.responseJSON.errorMsg;
          } else if (err.responseJSON.msg) {
            errorMsg = err.responseJSON.msg;
          }
        } else if (err.responseText) {
          errorMsg = err.responseText;
        }
        alert(errorMsg);
      }
    });
  }
  
  function addDevice() {
    // 获取设备ID和生产日期
    var deviceId = $("#addDeviceId").val();
    var productionDate = $("#addProductionDate").val();
    
    // 检查设备ID是否为空
    if (!deviceId) {
      alert("请输入设备ID");
      return;
    }
    
    // 检查生产日期是否为空
    if (!productionDate) {
      alert("请选择生产日期");
      return;
    }
    
    // 调用API添加设备
    var url = "/api/device";
    
    $.ajax(url, {
      method: "POST",
      dataType: "json",
      contentType: "application/json",
      data: JSON.stringify({
        device_id: deviceId,
        production_date: productionDate
      }),
      success: function (res) {
        if (res && res.data !== undefined) {
          alert(res.data);
          // 清空表单
          $("#addDeviceId").val("");
          $("#addProductionDate").val("");
        } else {
          alert("添加结果格式异常");
        }
      },
      error: function (err) {
        var errorMsg = "添加设备失败，请稍后重试";
        if (err.responseJSON) {
          if (err.responseJSON.errorMsg) {
            errorMsg = err.responseJSON.errorMsg;
          } else if (err.responseJSON.msg) {
            errorMsg = err.responseJSON.msg;
          }
        } else if (err.responseText) {
          errorMsg = err.responseText;
        }
        alert(errorMsg);
      }
    });
  }
</script>

</html>
